#!/bin/sh

link() {
    dest="$1"
    shift
    for f in "$@"; do
        ln -snfv "$PWD/$f" "$dest"
    done
}

link_dir() {
    mkdir -p "$1"
    link "$@"
}

cmd() {
    command -v "$1" > /dev/null
}

mkdir -p ~/.config/systemd/user

if cmd bat; then
    link_dir ~/.config/bat bat/*
fi

if cmd picom; then
    link ~/.config/picom.conf picom.conf
fi

if cmd git; then
    link ~/.gitconfig gitconfig
fi

if cmd kitty; then
    link_dir ~/.config/kitty kitty/*
fi

if cmd ranger; then
    link_dir ~/.config/ranger ranger/*
fi

if cmd podman; then
    link_dir ~/.config/containers containers/*
fi

if cmd ssh; then
    link_dir ~/.ssh ssh/*
fi

if cmd gpg-agent; then
    mkdir -p ~/.gnupg
    link ~/.gnupg/gpg-agent.conf gpg-agent.conf
fi

for u in systemd/user/*; do
    n="${u#systemd/user/}"
    n="${n%%.*}"
    if cmd "${n%%_*}"; then
        link ~/.config/systemd/user "$u"
        systemctl --user enable "$n"
    fi
done
